# Микросервис для принятия и создания заявки по смене номера в JIRA.

## Требования к серверу
- Сервер с устанвленной ОС Linux. Желательно CentOS 7.
- Установленный docker. [Инструкция по установке](https://docs.docker.com/engine/install/centos/) .
## Запуск
### В режиме разработки
- Должна быть установлена [nodejs](https://nodejs.org/en/download/) для запуска без докера. При разработке использовалась версия v14.5.0 
- ```npm install && npm start```
### Production
- Должна быть запущена база данных MongoDb. Порт базы данных указывается в конфиг файле main.
- ```sh build.sh ```
- ```sh run.sh ```

## Остановка
### Для того чтобы остановить контейнер 
- ```sh stop.sh ```

## Общие сведения

### Микросервис принимает данные заявки (Multipart/formdata) по адресу http://hostname:port/changeOpt24Num.
### Полученные данные проходят проверку по следующим пунктам:
- База данных Optima24 для проверки текущего номера клиента;
- База данных АБС для проверки наличия активных карт клиента;
- База данных АБС для проверки паспортных данных клиента.

### При успешном прохождении проверки данных формируется application code (Номер заявки).
### Создается заявка в JIRA. К созданной заявке прикрепляются фотографии паспорта клиента. Если на этапе прикрепления фотографий возникнет ошибка, приложение удаляет заявку в JIRA.
### После успешного создания заявки в JIRA клиенту отправляется СМС-уведомление с номером заявки на новый номер телефона, указанный в анкете. В случае возникновения ошибки при отправке СМС, приложение попытается переотправить сообщение через три минуты.
### На каждом логическом этапе приложение создает логи (FAIL, SUCCESS, ERROR). Все логи пишутся во Fluentd.